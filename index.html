<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Take a Note</title>
  <!-- Dummy favicon to prevent 404 -->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <!-- Telegram Web App initialization script -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    #note { width: 100%; height: 150px; }
    #send { margin-top: .5rem; padding: .5rem 1rem; }
  </style>
</head>
<body>
  <h1>ğŸ“ Take a Note</h1>
  <textarea id="note" placeholder="Write your note hereâ€¦"></textarea><br>
  <button id="send">Submit</button>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const sendBtn = document.getElementById('send');
    const noteFld = document.getElementById('note');
    let userId;

    // 1. Ensure we're inside the Telegram Web App
    if (window.Telegram && window.Telegram.WebApp) {
      // Expand the Web App to full height (optional)
      window.Telegram.WebApp.expand();
      // Retrieve the Telegram user ID
      userId = window.Telegram.WebApp.initDataUnsafe.user.id;
    } else {
      alert(
        'âš ï¸ This page must be opened from within your Telegram Botâ€™s Web App.\n' +
        'Please click the â€œTake a Noteâ€ button in the bot chat.'
      );
      // Prevent further action
      sendBtn.disabled = true;
      return;
    }

    // 2. Handle Submit
    sendBtn.addEventListener('click', async () => {
      const note = noteFld.value.trim();
      if (!note) {
        alert('Please enter some text first.');
        return;
      }

      try {
        const response = await fetch('https://penguinote-subdomain.loca.lt/api/notes/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ note, user_id: userId }),
        });

        if (!response.ok) {
          const err = await response.json().catch(() => ({}));
          throw new Error(err.error || response.statusText);
        }

        const result = await response.json();
        alert('âœ… Saved successfully:\n' + JSON.stringify(result, null, 2));
        noteFld.value = '';
      } catch (e) {
        alert('âŒ Error saving note:\n' + e.message);
      }
    });
  });
  </script>
</body>
</html>
